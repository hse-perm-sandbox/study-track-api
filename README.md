# study-track-api
Серверная часть web-приложения для управления задачами

Study Track — web-приложение, ориентированное на студентов, с функциями, специально адаптированными под учебный процесс: задачи, категории, приоритеты, напоминания, календарное отображение.

## Оглавление
- [Функции приложения](#функции-приложения)
- [Установка и запуск приложения локально](#установка-и-запуск-приложения-локально)
    - [Предварительные требования](#предварительные-требования)
    - [Шаги установки](#шаги-установки)
- [Разработка приложения](#разработка-приложения)
    - [Запуск приложения в режиме разработки](#запуск-приложения-в-режиме-разработки)
    - [Отладка приложения в VS Code](#отладка-приложения-в-vs-code)
- [Организация работы с зависимостями проекта](#организация-работы-с-зависимостями-проекта)
    - [Зачем нужно управление зависимостями?](#зачем-нужно-управление-зависимостями)
    - [Что такое Poetry?](#что-такое-poetry)
    - [Основные файлы Poetry](#основные-файлы-poetry)
    - [Основные команды Poetry](#основные-команды-poetry)
    - [Рекомендации](#рекомендации)
- [Конфигурирование приложения и работа с переменными окружения](#конфигурирование-приложения-и-работа-с-переменными-окружения)
    - [Что такое переменные окружения?](#что-такое-переменные-окружения)
    - [Файл .env](#файл-env)
    - [Как использовать переменные окружения и .env в этом проекте](#как-использовать-переменные-окружения-и-env-в-этом-проекте)
    - [Почему нельзя хранить секретные данные в исходном коде?](#почему-нельзя-хранить-секретные-данные-в-исходном-коде)
    - [Как задать переменные окружения вручную](#как-задать-переменные-окружения-вручную)
    - [Рекомендации](#рекомендации-по-работе-с-переменными)
- [Миграции базы данных](#миграции-базы-данных)
    - [Зачем нужны миграции?](#зачем-нужны-миграции)
    - [Как это работает?](#как-это-работает)
    - [Alembic в этом проекте](#alembic-в-этом-проекте)
    - [Как изменить структуру данных и создать миграцию?](#как-изменить-структуру-данных-и-создать-миграцию)
    - [Полезные команды Alembic](#полезные-команды-alembic)
    - [Рекомендации](#рекомендации-по-работе-с-миграциями)

## Функции приложения

- Регистрация и вход в аккаунт
- Создание, редактирование и удаление задач
- Классификация задач по категориям
- Установка приоритетов и дедлайнов
- Настройка уведомлений (email, push)
- Отображение задач в календаре
- Визуальное планирование учебной нагрузки


## Установка и запуск приложения локально
### Предварительные требования
- Python 3.12
- Python venv

### Шаги установки
1. Клонируйте репозиторий:

    ```sh
    git clone https://github.com/hse-perm-sandbox/study-track-api.git
    cd study-track-api
    ```

2. Установите Python 3.12 и модуль `venv` (если они еще не установлены).

3. Создайте виртуальное окружение:

    ```sh
    python3 -m venv .venv
    ```

    для windows, если версия 3.12 установлена как версия Python по умолчанию:

    ```sh
    python -m venv .venv
    ```
    

    для windows, если по умолчанию установлена другая версия Python, для выполнения интерпретатором версии 3.12:

    ```sh
    py -3.12 -m venv .venv
    ```


4. Активируйте виртуальное окружение:

    ```sh
    source .venv/bin/activate
    ```

    для windows:

    ```sh
    .venv\Scripts\activate.bat
    ```

5. Установите Poetry:

    ```sh
    pip install poetry
    ```

6. Установите зависимости проекта:

    ```sh
    poetry install
    ```

7.  Запустите приложение:

    ```sh
    poetry run start
    ```

Документация API запущенного приложения в формате Swagger доступна в браузере по адресу http://127.0.0.1:8080/docs

## Разработка приложения

### Запуск приложения в режиме разработки

Запустить приложение локально в режиме разработки можно командой:

```sh
poetry run dev
```

При этом сервер запускает приложение в режиме reload, то есть перезапускается после внесения изменений в исходный код.

### Отладка приложения в VS Code

Для отладки приложения необходимо добавить в файл .vscode/launch.json конфигурацию отладки:

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python Debugger: FastAPI",
            "type": "debugpy",
            "request": "launch",
            "module": "uvicorn",
            "args": [
                "src.dev:app",
                "--reload",
                "--host",
                "0.0.0.0",
                "--port",
                "8080"
            ]
        }
    ]
}
```

После чего в разделе RUN AND DEBUG необходимо выбрать и запусти конфигурацию отладки с названием "Python Debugger: FastAPI".

Swagger UI для запущенного приложения будет доступен в браузере по адресу http://0.0.0.0:8080/docs

## Организация работы с зависимостями проекта

### Зачем нужно управление зависимостями?

В процессе разработки приложения часто требуется использовать сторонние библиотеки (например, FastAPI, Uvicorn и др.). Управление зависимостями позволяет:

- **Гарантировать, что у всех участников команды одинаковые версии библиотек** — это снижает вероятность ошибок, связанных с несовместимостью версий.
- **Автоматизировать установку и обновление библиотек** — не нужно вручную скачивать и устанавливать каждую зависимость.
- **Обеспечить воспроизводимость окружения** — приложение будет одинаково работать на разных компьютерах и серверах.

### Что такое Poetry?

[Poetry](https://python-poetry.org/) — это современный менеджер зависимостей и инструмент для управления проектами на Python. Он позволяет:
- Описывать зависимости проекта в одном файле (`pyproject.toml`)
- Устанавливать, обновлять и удалять библиотеки одной командой
- Изолировать зависимости проекта в виртуальном окружении

### Основные файлы Poetry

- **`pyproject.toml`** — основной файл конфигурации проекта. В нем указываются все зависимости, настройки проекта и скрипты запуска.
- **`poetry.lock`** — автоматически создаётся Poetry и содержит точные версии всех установленных библиотек и их зависимостей. Благодаря этому можно быть уверенным, что у всех разработчиков и на сервере будут одинаковые версии библиотек.

### Основные команды Poetry

- **Установка всех зависимостей проекта** (после клонирования репозитория):

    ```sh
    poetry install
    ```

- **Добавление новой библиотеки** (например, requests):

    ```sh
    poetry add requests
    ```

- **Удаление библиотеки** (например, requests):

    ```sh
    poetry remove requests
    ```

- **Обновление всех зависимостей до последних разрешённых версий:**

    ```sh
    poetry update
    ```

- **Запуск команд внутри виртуального окружения Poetry:**

    ```sh
    poetry run <команда>
    # Например:
    poetry run python main.py
    ```

### Рекомендации
- **Не редактируйте вручную файлы `pyproject.toml` и `poetry.lock`** — используйте только команды Poetry.
- **Всегда выполняйте `poetry install` после получения новых изменений из репозитория**, чтобы установить новые зависимости.
- **Если добавили или удалили библиотеку — обязательно закоммитьте изменения в `pyproject.toml` и `poetry.lock`.**

Подробнее о Poetry можно узнать в [официальной документации](https://python-poetry.org/docs/).

## Конфигурирование приложения и работа с переменными окружения

Для гибкой настройки приложения используются переменные окружения и файл `.env`. Это позволяет удобно менять параметры работы (например, настройки базы данных, секретные ключи, параметры почты) без необходимости изменять исходный код.

### Что такое переменные окружения?

Переменные окружения — это специальные значения, которые задаются в операционной системе и могут быть использованы приложением во время выполнения. Например, можно задать имя пользователя и пароль для подключения к базе данных, не прописывая их в коде.

### Файл `.env`

Файл `.env` — это текстовый файл в корне проекта, в котором хранятся пары ключ=значение, например:

```
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=supersecret
POSTGRES_DB=studytrack
```

При запуске приложения значения из `.env` автоматически подставляются в соответствующие переменные окружения.

**Важно:** Файл `.env` обычно добавляют в `.gitignore`, чтобы не хранить секретные данные (например, пароли) в репозитории.

### Как использовать переменные окружения и `.env` в этом проекте

В проекте используется библиотека [pydantic-settings](https://docs.pydantic.dev/latest/integrations/settings/), которая автоматически подгружает переменные из `.env` и окружения. Все основные параметры приложения описаны в файле `src/config.py`.

**Пример:**
Если вы хотите изменить параметры подключения к базе данных, создайте или отредактируйте файл `.env` в корне проекта и укажите нужные значения.

### Почему нельзя хранить секретные данные в исходном коде?

- **Безопасность:** Если пароли и ключи попадут в публичный репозиторий, злоумышленники смогут получить доступ к вашей базе данных или другим сервисам.
- **Гибкость:** Для разных окружений (разработка, тестирование, продакшн) удобно использовать разные настройки, не меняя код.
- **Командная работа:** Каждый разработчик может использовать свои параметры, не мешая другим.

### Как задать переменные окружения вручную

Можно задать переменные окружения прямо в терминале перед запуском приложения:

```sh
export POSTGRES_PASSWORD=supersecret
poetry run start
```

### Рекомендации по работе с переменными

- Все чувствительные и изменяемые параметры выносите в `.env` или переменные окружения.
- Не добавляйте `.env` в репозиторий.
- Для новых параметров просто добавьте их в `.env` и используйте в коде через класс `Settings` из `src/config.py`.

## Миграции базы данных

### Зачем нужны миграции?

В процессе разработки приложения структура базы данных (например, таблицы, поля, типы данных) часто меняется: добавляются новые сущности, изменяются существующие, удаляются устаревшие поля. Миграции позволяют автоматически и безопасно применять такие изменения к базе данных, чтобы все разработчики и серверы работали с одной и той же актуальной структурой данных.

**Миграции** — это последовательность шагов (скриптов), которые переводят базу данных из одного состояния в другое. Благодаря миграциям можно:
- Изменять структуру БД без потери данных
- Легко откатывать изменения при ошибках
- Синхронизировать структуру БД между всеми участниками команды

### Как это работает?

Миграции — это специальные Python-скрипты, которые создаются автоматически или вручную с помощью инструмента Alembic. Каждый такой скрипт содержит инструкции, как изменить структуру базы данных (например, создать новую таблицу или добавить столбец). Alembic отслеживает, какие миграции уже применены, и позволяет применять новые или откатывать старые.

### Alembic в этом проекте

В проекте используется библиотека [Alembic](https://alembic.sqlalchemy.org/), которая интегрируется с SQLAlchemy и позволяет удобно управлять миграциями. Все миграции хранятся в папке `migrations/versions`.

### Как изменить структуру данных и создать миграцию?

1. **Измените модели данных**  
   Например, добавьте новое поле в класс модели в папке `src/db/models`.

2. **Сгенерируйте новую миграцию**  
   Выполните команду:
   ```sh
   alembic revision --autogenerate -m "описание изменения"
   ```
   Alembic сравнит текущие модели и структуру БД, и создаст скрипт миграции.

3. **Примените миграцию к базе данных**  
   Выполните команду:
   ```sh
   alembic upgrade head
   ```
   После этого структура базы данных обновится в соответствии с изменениями.

### Полезные команды Alembic

- **Создать новую миграцию (автоматически):**
  ```sh
  alembic revision --autogenerate -m "описание"
  ```
- **Применить все новые миграции:**
  ```sh
  alembic upgrade head
  ```
- **Откатить последнюю миграцию:**
  ```sh
  alembic downgrade -1
  ```
- **Посмотреть текущий статус миграций:**
  ```sh
  alembic current
  ```
- **Показать историю миграций:**
  ```sh
  alembic history
  ```

### Рекомендации по работе с миграциями
- После изменения моделей всегда создавайте и применяйте миграцию.
- Не редактируйте файлы миграций вручную, если не уверены в своих действиях.
- Все миграции должны быть в репозитории, чтобы команда работала с одной структурой данных.
